<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapid Prototyping Series | Keenen Woods</title>
    
    <!-- Shared Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@300;500;700&family=Segoe+UI&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>

    <style>
        /* --- GLOBAL & HUB STYLES --- */
        body { margin: 0; overflow-x: hidden; background: #0f172a; font-family: 'Inter', sans-serif; }
        
        .view-section { display: none; width: 100vw; min-height: 100vh; animation: fadeIn 0.3s ease-out; }
        .view-active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Hub Glassmorphism */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }
        .glass-panel:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3); border-color: rgba(56, 189, 248, 0.4); }
        
        .hub-grid {
            background-image: linear-gradient(rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.95)),
                              linear-gradient(rgba(56, 189, 248, 0.1) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(56, 189, 248, 0.1) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
        }

        /* --- APP SPECIFIC STYLES --- */
        
        /* Game V2 */
        #view-game .game-container { font-family: 'Segoe UI', sans-serif; text-align: center; color: white; background: #2c3e50; min-height: 100vh; padding-top: 60px; }
        #view-game .game-box { max-width: 600px; margin: 0 auto; background: #34495e; padding: 30px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        #view-game .click-btn { background-color: #e74c3c; color: white; border: none; width: 180px; height: 180px; border-radius: 50%; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 8px 0 #c0392b; transition: all 0.1s; margin-bottom: 30px; }
        #view-game .click-btn:active { box-shadow: 0 0 0 #c0392b; transform: translateY(8px); }
        #view-game .upgrade-btn { background-color: #95a5a6; padding: 15px; border-radius: 8px; cursor: pointer; color: #2c3e50; font-weight: bold; display: flex; justify-content: space-between; margin-bottom: 10px; width: 100%; }
        #view-game .affordable { background-color: #3498db; color: white; }

        /* Agent Sim */
        #view-agent .agent-body { font-family: 'Segoe UI', sans-serif; background-color: #1a1a2e; color: #e0e0e0; min-height: 100vh; padding: 20px; padding-top: 80px; }
        #view-agent .column { background: #16213e; padding: 15px; border-radius: 10px; min-height: 400px; }
        #view-agent .task-card { background: #0f3460; padding: 15px; margin-bottom: 10px; border-radius: 5px; border-left: 4px solid #4ecca3; animation: fadeIn 0.5s; }
        #view-agent .agent-badge { background: #e94560; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 10px; }

        /* Decision Tool */
        #view-decision .decision-body { font-family: 'Segoe UI', sans-serif; background-color: #ecf0f1; color: #2c3e50; min-height: 100vh; padding: 20px; padding-top: 80px; display: flex; flex-direction: column; align-items: center; }
        #view-decision .bar-track { background-color: #eee; height: 25px; border-radius: 12px; overflow: hidden; width: 100%; }
        #view-decision .bar-fill { height: 100%; background-color: #3498db; width: 0%; transition: width 0.3s ease-out; color: white; text-align: right; padding-right: 10px; font-size: 0.8rem; line-height: 25px; }

        /* RAG Sim */
        #view-rag .rag-body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; color: #333; min-height: 100vh; padding: 40px; padding-top: 80px; }
        #view-rag .pipeline { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 30px; opacity: 0.6; transition: opacity 0.5s; }
        #view-rag .pipeline.active { opacity: 1; }
        #view-rag .stage-card { background: white; padding: 20px; border-radius: 10px; border-top: 5px solid #ccc; min-height: 200px; }
        #view-rag .code-block { background: #282c34; color: #abb2bf; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; margin-top: 10px; height: 150px; overflow-y: auto; font-size: 0.85rem; }

        /* Nexus Styles */
        .nexus-theme-work { background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); color: #0f172a; }
        .nexus-theme-life { background: linear-gradient(135deg, #4f46e5 0%, #be185d 100%); color: white; }
        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; background-color: currentColor; border-radius: 50%; display: inline-block; height: 6px; width: 6px; margin: 0 1px; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; } .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    </style>
</head>
<body>

    <!-- ==================== VIEW: SYSTEM HUB (MAIN MENU) ==================== -->
    <section id="view-hub" class="view-section view-active hub-grid min-h-screen flex flex-col text-slate-200">
        
        <!-- Global Settings -->
        <div class="absolute top-4 right-6 z-50">
            <button onclick="toggleGlobalSettings()" class="text-slate-400 hover:text-sky-400 transition-colors flex items-center gap-2">
                <span class="text-xs uppercase tracking-widest">System Access</span> <i class="fas fa-cog text-xl"></i>
            </button>
        </div>

        <header class="w-full max-w-7xl mx-auto px-6 py-12">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 border-b border-slate-700/50 pb-8">
                <div>
                    <h1 class="text-3xl md:text-5xl font-bold text-white tracking-tight mb-2">Rapid Prototyping Series</h1>
                    <p class="text-sky-400 text-lg">Bridging I/O Psychology and AI Systems</p>
                </div>
                <div class="mt-4 md:mt-0 text-right">
                    <div class="text-white font-medium text-lg">Keenen Woods</div>
                    <div class="text-sm text-slate-500 font-mono">Systems Developer</div>
                </div>
            </div>

            <div class="glass-panel p-8 rounded-2xl mb-12 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl text-white"><i class="fas fa-network-wired"></i></div>
                <h2 class="text-xs font-bold text-sky-400 uppercase tracking-widest mb-4">System Architecture</h2>
                <div class="grid md:grid-cols-3 gap-8 relative z-10">
                    <div class="md:col-span-2 text-slate-300 leading-relaxed">
                        <p class="mb-4">This portfolio presents functional system prototypes designed to demonstrate applied systems thinking at the intersection of <strong>organizational transformation</strong>, <strong>human performance</strong>, and <strong>AI-enabled workflows</strong>.</p>
                        <p>Using a <strong>Glass Box Philosophy</strong>, each prototype exposes system logic and decision rules, treating AI not as a black box, but as a governable component of the enterprise.</p>
                    </div>
                    <div class="border-l border-slate-700 pl-8 flex flex-col justify-center space-y-4">
                        <div><div class="text-slate-500 text-xs uppercase mb-1">Core Stack</div><div class="text-white font-medium font-mono text-sm">HTML5 â€¢ JS â€¢ Gemini API</div></div>
                        <div><div class="text-slate-500 text-xs uppercase mb-1">Focus</div><div class="text-white font-medium text-sm">Governance & Adoption</div></div>
                    </div>
                </div>
            </div>
        </header>

        <main class="w-full max-w-7xl mx-auto px-6 pb-20">
            <h3 class="text-xl font-bold text-white mb-6 pl-2 border-l-4 border-sky-500">System Artifacts</h3>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">

                <!-- 01: Governance -->
                <div onclick="switchView('gov')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-sky-500 hover:bg-slate-800 transition-colors">
                    <div class="text-sky-400 text-3xl mb-4"><i class="fas fa-balance-scale"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-sky-300">01. AI Governance Audit</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">Interactive dashboard converting abstract governance principles into executable decision gates.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">Risk Logic</span></div>
                </div>

                <!-- 02: Portfolio -->
                <div onclick="switchView('portfolio')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-slate-500 hover:bg-slate-800">
                    <div class="text-slate-400 text-3xl mb-4"><i class="fas fa-id-card"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-white">02. Human Systems Interface</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">Models professional identity as a coherent system. Includes live API integration for daily insights.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">Static Grid</span></div>
                </div>

                <!-- 03: Decision Tool -->
                <div onclick="switchView('decision')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-indigo-500 hover:bg-slate-800">
                    <div class="text-indigo-400 text-3xl mb-4"><i class="fas fa-sliders-h"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-indigo-300">03. Strategic Trade-Off Engine</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">Weighted decision analysis tool. Visualizes tradeoffs between competing variables in real-time.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">Data Vis</span></div>
                </div>

                <!-- 04: Transformation Tycoon -->
                <div onclick="switchView('game')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-yellow-500 hover:bg-slate-800">
                    <div class="text-yellow-400 text-3xl mb-4"><i class="fas fa-chess-board"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-yellow-300">04. Transformation Tycoon</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">State-based simulation modeling organizational change as a resource system with feedback loops.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">Simulation</span></div>
                </div>

                <!-- 05: Agentic Workflow -->
                <div onclick="switchView('agent')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-pink-500 hover:bg-slate-800">
                    <div class="text-pink-400 text-3xl mb-4"><i class="fas fa-robot"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-pink-300">05. Agentic Workflow Sim</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">Visualizes autonomous agents claiming tasks from a queue. Demonstrates decentralized decision logic.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">OOP</span></div>
                </div>

                <!-- 06: Glass Box RAG -->
                <div onclick="switchView('rag')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-emerald-500 hover:bg-slate-800">
                    <div class="text-emerald-400 text-3xl mb-4"><i class="fas fa-search"></i></div>
                    <h4 class="text-lg font-bold text-white mb-2 group-hover:text-emerald-300">06. Glass Box RAG Engine</h4>
                    <p class="text-sm text-slate-400 mb-4 h-16">Demystifies "Retrieval Augmented Generation" by visualizing the retrieval pipeline and context injection.</p>
                    <div class="flex gap-2"><span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">Search Logic</span></div>
                </div>

                <!-- 07: NEXUS PRO -->
                <div onclick="switchView('nexus')" class="glass-panel rounded-xl p-6 relative group cursor-pointer border-t-4 border-t-purple-500 md:col-span-2 lg:col-span-3 bg-gradient-to-r from-purple-900/40 to-blue-900/40 hover:from-purple-900/60">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-purple-400 text-3xl mb-4"><i class="fas fa-layer-group"></i></div>
                            <h4 class="text-lg font-bold text-white mb-2 group-hover:text-purple-300">07. NEXUS | AI Operating System</h4>
                            <p class="text-sm text-slate-400 max-w-xl">
                                The flagship artifact. A dual-mode (Work/Life) AI assistant featuring computer vision, live web search grounding, context switching, and specialized tool integration.
                            </p>
                        </div>
                        <div class="hidden md:block text-5xl opacity-20 text-purple-200"><i class="fas fa-microchip"></i></div>
                    </div>
                </div>

            </div>
        </main>
    </section>

    <!-- ==================== ARTIFACT 1: GOVERNANCE ==================== -->
    <section id="view-gov" class="view-section bg-slate-50 min-h-screen text-slate-900">
        <nav class="bg-white shadow-sm border-b px-6 py-4 flex justify-between items-center sticky top-0 z-40">
            <div class="flex items-center gap-4">
                <button onclick="switchView('hub')" class="text-slate-500 hover:text-blue-900 font-bold"><i class="fas fa-arrow-left"></i> Portfolio</button>
                <div class="h-6 w-px bg-slate-300"></div>
                <span class="font-bold text-xl">Governance <span class="text-blue-900">Audit</span></span>
            </div>
        </nav>
        <div class="max-w-5xl mx-auto p-8">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Evaluation Form -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-lg text-slate-900 mb-4">Risk Assessment</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">Decision Impact</label>
                            <select id="gov-impact" class="w-full p-2 border rounded"><option value="low">Low</option><option value="high">High (Legal/Financial)</option></select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">Human Accountability</label>
                            <select id="gov-owner" class="w-full p-2 border rounded"><option value="yes">Defined Owner</option><option value="no">Undefined</option></select>
                        </div>
                        <button onclick="assessGovRisk()" class="w-full bg-slate-800 text-white py-2 rounded font-bold">Check Status</button>
                        <div id="gov-status" class="hidden p-4 rounded bg-slate-100 text-center font-bold text-sm"></div>
                    </div>
                </div>
                <!-- AI Red Team -->
                <div class="bg-gradient-to-br from-blue-900 to-slate-900 text-white p-6 rounded-xl shadow-lg">
                    <h3 class="font-bold text-lg mb-2 flex items-center gap-2"><i class="fas fa-user-secret"></i> Red Team Auditor</h3>
                    <p class="text-xs text-blue-200 mb-4">Describe your use case. I will find the failure modes.</p>
                    <textarea id="gov-audit-input" class="w-full h-32 p-3 text-slate-900 rounded text-sm mb-4" placeholder="e.g. Chatbot for HR benefits..."></textarea>
                    <button onclick="runGovAudit()" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded font-bold transition-colors">Audit Risks (Gemini)</button>
                    <div id="gov-audit-result" class="mt-4 text-sm text-blue-100 hidden"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 2: PORTFOLIO ==================== -->
    <section id="view-portfolio" class="view-section bg-slate-100 min-h-screen text-slate-800 font-sans">
        <nav class="bg-white shadow-sm border-b px-6 py-4 sticky top-0 z-40">
            <button onclick="switchView('hub')" class="text-slate-500 hover:text-blue-900 font-bold"><i class="fas fa-arrow-left"></i> Back</button>
        </nav>
        <div class="max-w-4xl mx-auto p-8">
            <div class="bg-white p-8 rounded-lg shadow mb-6">
                <h1 class="text-3xl font-bold text-blue-900 mb-2">Keenen Woods</h1>
                <p class="text-lg text-slate-600">I/O Psychologist & Systems Thinker</p>
                <div class="my-6 border-l-4 border-green-500 pl-4 bg-green-50 p-4">
                    <h3 class="font-bold text-green-800 text-sm uppercase">Daily Leadership Insight (Live API)</h3>
                    <p id="quote-text" class="italic text-slate-700 mt-1">Loading...</p>
                    <button onclick="getAdvice()" class="text-xs text-green-700 font-bold mt-2 hover:underline">Refresh</button>
                </div>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold border-b pb-2 mb-4 text-blue-900">Human Systems</h3>
                    <ul class="space-y-2 text-sm"><li>Org Change Management</li><li>Workforce Strategy</li><li>Hogan Assessments</li></ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold border-b pb-2 mb-4 text-blue-900">Technical Systems</h3>
                    <ul class="space-y-2 text-sm"><li>Lean Six Sigma</li><li>Digital Transformation</li><li>AI Readiness</li></ul>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 3: DECISION TOOL ==================== -->
    <section id="view-decision" class="view-section">
        <div class="decision-body">
            <div class="w-full max-w-4xl mb-6"><button onclick="switchView('hub')" class="text-slate-500 hover:text-blue-600 font-bold"><i class="fas fa-arrow-left"></i> Portfolio</button></div>
            <h1 class="text-2xl font-bold mb-2">Strategic Trade-Off Engine</h1>
            <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-4xl">
                <div class="flex justify-between mb-6">
                    <h3 class="font-bold">Priorities (Weights)</h3>
                    <button onclick="loadDemoData()" class="text-blue-600 font-bold text-sm hover:underline">Load Demo Data</button>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div id="sliders-container" class="space-y-4"></div>
                    <div class="md:col-span-2">
                        <h3 class="font-bold mb-4 border-b pb-2">Ranking</h3>
                        <div id="chart-container" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 4: GAME V2 ==================== -->
    <section id="view-game" class="view-section">
        <div class="game-container">
            <button onclick="switchView('hub')" class="absolute top-4 left-4 text-white hover:text-yellow-400 font-bold"><i class="fas fa-arrow-left"></i> Exit Sim</button>
            <div class="game-box">
                <h1 class="text-yellow-400 text-3xl font-bold mb-4">Transformation Tycoon</h1>
                <div class="bg-slate-800 p-4 rounded-lg border-2 border-yellow-400 mb-6">
                    <div class="text-slate-400 text-sm">Stakeholder Buy-In</div>
                    <div id="score" class="text-4xl font-bold text-green-400">0</div>
                    <div class="text-xs text-slate-500 mt-1">per second: <span id="sps">0</span></div>
                </div>
                <button class="click-btn" onclick="clickWork()">HOST<br>MEETING</button>
                <div class="space-y-2 text-left">
                    <button id="btn-coffee" class="upgrade-btn opacity-50" onclick="buyUpgrade('coffee')">
                        <span>â˜• Buy Coffee (+1/s)</span> <span>Cost: 15</span>
                    </button>
                    <button id="btn-intern" class="upgrade-btn opacity-50" onclick="buyUpgrade('intern')">
                        <span>ðŸŽ“ Hire Intern (+5/s)</span> <span>Cost: 100</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 5: AGENT SIM ==================== -->
    <section id="view-agent" class="view-section">
        <div class="agent-body">
            <button onclick="switchView('hub')" class="mb-4 text-emerald-400 font-bold"><i class="fas fa-arrow-left"></i> Exit</button>
            <h1 class="text-center text-2xl font-bold text-emerald-400 mb-6">Agentic Workflow Simulator</h1>
            <div class="text-center mb-8 space-x-4">
                <button class="bg-emerald-500 text-slate-900 px-4 py-2 rounded font-bold hover:bg-emerald-400" onclick="createTask()">+ Add Task</button>
                <button class="bg-pink-600 text-white px-4 py-2 rounded font-bold hover:bg-pink-500" onclick="spawnAgent()">+ Deploy Agent</button>
            </div>
            <div class="grid grid-cols-3 gap-4 max-w-5xl mx-auto">
                <div class="column" id="col-todo"><h2 class="text-center border-b border-slate-700 pb-2 mb-4">Pending</h2><div id="list-todo"></div></div>
                <div class="column" id="col-doing"><h2 class="text-center border-b border-slate-700 pb-2 mb-4">Processing</h2><div id="list-doing"></div></div>
                <div class="column" id="col-done"><h2 class="text-center border-b border-slate-700 pb-2 mb-4">Done</h2><div id="list-done"></div></div>
            </div>
            <div id="agent-log" class="text-center mt-6 font-mono text-emerald-400 text-sm h-6">System Ready...</div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 6: RAG SIM ==================== -->
    <section id="view-rag" class="view-section">
        <div class="rag-body">
            <button onclick="switchView('hub')" class="mb-4 text-blue-600 font-bold"><i class="fas fa-arrow-left"></i> Portfolio</button>
            <h1 class="text-center text-2xl font-bold text-slate-700 mb-6">Glass Box RAG Engine</h1>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                <div class="flex gap-4 mb-6">
                    <input type="text" id="ragQuery" placeholder="Ask about 'Secret Code' or 'Wifi'..." class="flex-1 p-3 border rounded">
                    <button onclick="runRAG()" class="bg-blue-600 text-white px-6 rounded font-bold">Ask</button>
                </div>
                <div class="pipeline grid md:grid-cols-3 gap-4">
                    <div class="stage-card border-t-4 border-orange-400 bg-slate-50 p-4 rounded">
                        <h3 class="font-bold text-sm">1. RETRIEVAL</h3>
                        <div class="code-block" id="log-r">Waiting...</div>
                    </div>
                    <div class="stage-card border-t-4 border-purple-400 bg-slate-50 p-4 rounded">
                        <h3 class="font-bold text-sm">2. AUGMENTATION</h3>
                        <div class="code-block" id="log-a">Waiting...</div>
                    </div>
                    <div class="stage-card border-t-4 border-green-400 bg-slate-50 p-4 rounded">
                        <h3 class="font-bold text-sm">3. GENERATION</h3>
                        <div class="code-block" id="log-g">Waiting...</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ARTIFACT 7: NEXUS PRO ==================== -->
    <section id="view-nexus" class="view-section nexus-theme-work flex flex-col h-screen overflow-hidden">
        <nav id="nexus-nav" class="w-full h-16 flex justify-between items-center px-6 shadow-sm bg-white/80 backdrop-blur">
            <div class="flex items-center gap-4">
                <button onclick="switchView('hub')" class="text-slate-500 hover:text-blue-600 font-bold"><i class="fas fa-arrow-left"></i></button>
                <div class="font-bold text-xl tracking-tight text-slate-800">NEXUS PRO</div>
            </div>
            <div class="flex bg-slate-200 rounded-full p-1">
                <button onclick="setNexusMode('work')" id="btn-nexus-work" class="px-4 py-1 rounded-full text-xs font-bold bg-white text-blue-900 shadow">WORK</button>
                <button onclick="setNexusMode('life')" id="btn-nexus-life" class="px-4 py-1 rounded-full text-xs font-bold text-slate-500">LIFE</button>
            </div>
        </nav>
        <div class="flex-1 flex overflow-hidden">
            <aside id="nexus-sidebar" class="w-64 bg-white/50 border-r hidden md:flex flex-col p-4 space-y-2">
                <div id="nexus-tools"></div>
            </aside>
            <section class="flex-1 flex flex-col relative">
                <div id="nexus-chat" class="flex-1 overflow-y-auto p-6 space-y-6">
                    <div id="nexus-welcome" class="h-full flex flex-col items-center justify-center opacity-50">
                        <div class="text-6xl mb-4">ðŸ’¼</div>
                        <p>Select a tool or upload an image.</p>
                    </div>
                </div>
                <div class="p-4 m-4 bg-white/80 backdrop-blur rounded-2xl flex items-center gap-2 shadow-lg border border-white/50">
                    <input type="file" id="nexus-img-in" class="hidden" accept="image/*" onchange="handleNexusImg()">
                    <button onclick="document.getElementById('nexus-img-in').click()" class="text-slate-400 hover:text-blue-600"><i class="fas fa-camera text-xl"></i></button>
                    <div id="nexus-img-preview" class="hidden w-10 h-10 rounded overflow-hidden border"><img id="nexus-img-display" class="w-full h-full object-cover"></div>
                    <input id="nexus-input" class="flex-1 bg-transparent border-none outline-none py-2" placeholder="Ask Nexus...">
                    <button onclick="handleNexusSend()" class="w-10 h-10 rounded-full bg-blue-600 text-white shadow hover:scale-105 transition"><i class="fas fa-arrow-up"></i></button>
                </div>
            </section>
        </div>
    </section>

    <!-- ==================== GLOBAL SETTINGS MODAL ==================== -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <h2 class="text-xl font-bold mb-4 text-slate-900">System Access</h2>
            <p class="text-sm text-slate-600 mb-4">Enter your Gemini API Key to enable AI features across all artifacts (Nexus, Governance, RAG).</p>
            <input type="password" id="api-key-input" class="w-full p-3 bg-slate-100 rounded border mb-4 font-mono text-sm" placeholder="Paste AIza... key here">
            <div class="flex justify-end gap-2">
                <button onclick="toggleGlobalSettings()" class="px-4 py-2 text-slate-500 font-bold hover:bg-slate-100 rounded">Close</button>
                <button onclick="saveGlobalKey()" class="px-4 py-2 bg-slate-900 text-white font-bold rounded hover:bg-black">Connect</button>
            </div>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT LOGIC ==================== -->
    <script>
        // --- 1. CORE SYSTEM LOGIC ---
        let apiKey = localStorage.getItem('rapid_proto_key') || "";
        let gameInterval = null;
        let agentInterval = null;
        
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('view-active'));
            document.getElementById('view-' + viewId).classList.add('view-active');
            
            // Start/Stop Loops based on view
            if (viewId === 'game') {
                if(!gameInterval) gameInterval = setInterval(() => { buyInPoints += pointsPerSecond; updateGameUI(); }, 1000);
            } else {
                if(gameInterval) { clearInterval(gameInterval); gameInterval = null; }
            }

            if (viewId === 'agent') {
                if(!agentInterval) agentInterval = setInterval(runAgentLoop, 100);
            } else {
                if(agentInterval) { clearInterval(agentInterval); agentInterval = null; }
            }

            // Init specific logic
            if(viewId === 'nexus') initNexus();
            if(viewId === 'portfolio') getAdvice();
        }

        function toggleGlobalSettings() {
            const modal = document.getElementById('settings-modal');
            modal.classList.toggle('hidden');
            if(!modal.classList.contains('hidden') && apiKey) {
                document.getElementById('api-key-input').value = apiKey;
            }
        }

        function saveGlobalKey() {
            const val = document.getElementById('api-key-input').value.trim();
            if(val) {
                apiKey = val;
                localStorage.setItem('rapid_proto_key', apiKey);
                toggleGlobalSettings();
                alert("System Connected. AI Features Enabled.");
            }
        }

        // --- 2. GOVERNANCE APP LOGIC ---
        function assessGovRisk() {
            const impact = document.getElementById('gov-impact').value;
            const owner = document.getElementById('gov-owner').value;
            const status = document.getElementById('gov-status');
            status.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-800', 'text-green-800');
            
            if(owner === 'no') {
                status.classList.add('bg-red-100', 'text-red-800');
                status.innerText = "ðŸ›‘ BLOCKED: Undefined Ownership.";
            } else if(impact === 'high') {
                status.classList.add('bg-amber-100', 'text-amber-800');
                status.innerText = "âš ï¸ CAUTION: Strict HITL Required.";
            } else {
                status.classList.add('bg-green-100', 'text-green-800');
                status.innerText = "âœ… APPROVED: Standard Oversight.";
            }
        }

        async function runGovAudit() {
            const input = document.getElementById('gov-audit-input').value;
            const resDiv = document.getElementById('gov-audit-result');
            if(!apiKey) { toggleGlobalSettings(); return; }
            
            resDiv.classList.remove('hidden');
            resDiv.innerHTML = "Auditing...";
            
            const prompt = `Act as a skeptical AI Governance Officer. Analyze this use case: "${input}". 1. Biggest Risk. 2. Required Guardrail. Be concise.`;
            const txt = await callGemini(prompt);
            resDiv.innerHTML = marked.parse(txt);
        }

        // --- 3. PORTFOLIO LOGIC (Live API) ---
        async function getAdvice() {
            const quoteBox = document.getElementById('quote-text');
            try {
                const res = await fetch('https://api.adviceslip.com/advice');
                const data = await res.json();
                quoteBox.innerText = `"${data.slip.advice}"`;
            } catch(e) { quoteBox.innerText = "System offline."; }
        }

        // --- 4. GAME V2 LOGIC ---
        let buyInPoints = 0, pointsPerSecond = 0;
        let costs = { coffee: 15, intern: 100 };
        
        function clickWork() { buyInPoints++; updateGameUI(); }
        
        function buyUpgrade(type) {
            if(buyInPoints >= costs[type]) {
                buyInPoints -= costs[type];
                costs[type] = Math.floor(costs[type] * 1.5);
                pointsPerSecond += (type === 'coffee' ? 1 : 5);
                updateGameUI();
            }
        }
        
        function updateGameUI() {
            const scoreEl = document.getElementById('score');
            if(scoreEl) {
                scoreEl.innerText = buyInPoints;
                document.getElementById('sps').innerText = pointsPerSecond;
                document.querySelector('#btn-coffee span:last-child').innerText = "Cost: " + costs.coffee;
                document.querySelector('#btn-intern span:last-child').innerText = "Cost: " + costs.intern;
                
                document.getElementById('btn-coffee').style.opacity = buyInPoints >= costs.coffee ? 1 : 0.5;
                document.getElementById('btn-intern').style.opacity = buyInPoints >= costs.intern ? 1 : 0.5;
            }
        }

        // --- 5. AGENT SIM LOGIC ---
        let tasks = [], agents = [];
        let agentId = 1, taskId = 1;

        function createTask() {
            const t = { id: taskId++, name: `Task-${taskId}`, progress: 0, status: 'todo', agent: null };
            tasks.push(t);
            renderAgentBoard();
        }

        function spawnAgent() {
            const a = { id: agentId++, name: `Agent-${agentId}`, status: 'idle' };
            agents.push(a);
            document.getElementById('agent-log').innerText = `Deployed ${a.name}`;
        }

        function runAgentLoop() {
            agents.forEach(a => {
                if(a.status === 'idle') {
                    const task = tasks.find(t => t.status === 'todo');
                    if(task) {
                        task.status = 'doing';
                        task.agent = a.name;
                        a.status = 'working';
                        renderAgentBoard();
                    }
                } else {
                    const task = tasks.find(t => t.agent === a.name && t.status === 'doing');
                    if(task) {
                        task.progress += 2; // Speed
                        if(task.progress >= 100) {
                            task.status = 'done';
                            a.status = 'idle';
                            renderAgentBoard();
                        } else {
                            // Visual update for progress
                            const bar = document.getElementById(`bar-${task.id}`);
                            if(bar) bar.style.width = task.progress + "%";
                        }
                    }
                }
            });
        }

        function renderAgentBoard() {
            const cols = { todo: document.getElementById('list-todo'), doing: document.getElementById('list-doing'), done: document.getElementById('list-done') };
            if(!cols.todo) return;
            
            Object.values(cols).forEach(c => c.innerHTML = '');
            
            tasks.forEach(t => {
                const el = document.createElement('div');
                el.className = "task-card";
                el.innerHTML = `<div>${t.name} <span class="agent-badge">${t.agent || ''}</span></div><div class="h-1 bg-slate-900 mt-2 rounded"><div id="bar-${t.id}" class="h-full bg-pink-500 transition-all" style="width:${t.progress}%"></div></div>`;
                cols[t.status].appendChild(el);
            });
        }

        // --- 6. DECISION TOOL LOGIC ---
        function loadDemoData() {
            const items = [
                {name: "Option A", scores: [80, 40, 90]},
                {name: "Option B", scores: [50, 90, 60]}, 
                {name: "Option C", scores: [70, 70, 70]}
            ];
            const sliders = document.getElementById('sliders-container');
            const chart = document.getElementById('chart-container');
            
            sliders.innerHTML = `<div class="p-2 border rounded">Cost <input type="range" class="w-full"></div>
                                 <div class="p-2 border rounded">Speed <input type="range" class="w-full"></div>
                                 <div class="p-2 border rounded">Quality <input type="range" class="w-full"></div>`;
                                 
            chart.innerHTML = '';
            items.forEach(i => {
                chart.innerHTML += `<div class="mb-2"><div class="flex justify-between text-sm"><span>${i.name}</span><span>${Math.floor(Math.random()*100)}%</span></div><div class="bar-track"><div class="bar-fill" style="width:${Math.random()*100}%"></div></div></div>`;
            });
        }

        // --- 7. RAG SIM LOGIC ---
        const ragKnowledge = [
            { k: "secret", v: "The secret code is 42." },
            { k: "wifi", v: "Guest Pass: 'Welcome2025'" }
        ];

        async function runRAG() {
            const q = document.getElementById('ragQuery').value.toLowerCase();
            const logs = { r: document.getElementById('log-r'), a: document.getElementById('log-a'), g: document.getElementById('log-g') };
            
            logs.r.innerText = "Scanning...";
            await new Promise(r => setTimeout(r, 500));
            
            const match = ragKnowledge.find(i => q.includes(i.k));
            if(match) {
                logs.r.innerText = `FOUND: ${match.k}`;
                logs.a.innerText = `Context Injected: "${match.v}"`;
                
                // If API Key exists, use it for Generation step
                if(apiKey) {
                    logs.g.innerText = "Generating with Gemini...";
                    const prompt = `Context: ${match.v}. User Question: ${q}. Answer based on context.`;
                    const txt = await callGemini(prompt);
                    logs.g.innerText = txt;
                } else {
                    logs.g.innerText = `AI Output (Mock): Based on records, ${match.v}`;
                }
            } else {
                logs.r.innerText = "No internal records found.";
                logs.a.innerText = "N/A";
                logs.g.innerText = "I don't know that.";
            }
        }

        // --- 8. NEXUS PRO LOGIC ---
        const NEXUS_TOOLS = {
            work: [{ name: "Pro Assistant", icon: "fa-comments" }, { name: "Email Polisher", icon: "fa-envelope" }, { name: "Risk Auditor", icon: "fa-balance-scale" }],
            life: [{ name: "Life Companion", icon: "fa-hand-sparkles" }, { name: "Fridge Forager", icon: "fa-utensils" }, { name: "Trip Planner", icon: "fa-plane" }]
        };
        let nexusMode = 'work', nexusImgBase64 = null;

        function initNexus() { renderNexusSidebar(); }

        function setNexusMode(mode) {
            nexusMode = mode;
            const nav = document.getElementById('nexus-nav');
            const btnW = document.getElementById('btn-nexus-work');
            const btnL = document.getElementById('btn-nexus-life');
            
            if(mode === 'work') {
                nav.className = "w-full h-16 flex justify-between items-center px-6 shadow-sm bg-white/90 text-slate-800";
                btnW.className = "px-4 py-1 rounded-full text-xs font-bold bg-white text-blue-900 shadow";
                btnL.className = "px-4 py-1 rounded-full text-xs font-bold text-slate-500";
            } else {
                nav.className = "w-full h-16 flex justify-between items-center px-6 shadow-sm bg-indigo-900/90 text-white";
                btnW.className = "px-4 py-1 rounded-full text-xs font-bold text-white/50";
                btnL.className = "px-4 py-1 rounded-full text-xs font-bold bg-white text-pink-600 shadow";
            }
            renderNexusSidebar();
        }

        function renderNexusSidebar() {
            const cont = document.getElementById('nexus-tools');
            cont.innerHTML = '';
            NEXUS_TOOLS[nexusMode].forEach(tool => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3 rounded flex items-center gap-3 hover:bg-black/5 transition text-sm font-medium";
                btn.innerHTML = `<i class="fas ${tool.icon} w-5 text-center"></i> ${tool.name}`;
                cont.appendChild(btn);
            });
        }

        function handleNexusImg() {
            const file = document.getElementById('nexus-img-in').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                nexusImgBase64 = e.target.result;
                document.getElementById('nexus-img-display').src = nexusImgBase64;
                document.getElementById('nexus-img-preview').classList.remove('hidden');
            };
            if(file) reader.readAsDataURL(file);
        }

        async function handleNexusSend() {
            const input = document.getElementById('nexus-input');
            const txt = input.value.trim();
            if(!txt && !nexusImgBase64) return;
            if(!apiKey) { toggleGlobalSettings(); return; }

            document.getElementById('nexus-welcome').style.display = 'none';
            document.getElementById('nexus-img-preview').classList.add('hidden');
            input.value = '';

            const chat = document.getElementById('nexus-chat');
            const uDiv = document.createElement('div');
            uDiv.className = "flex justify-end mb-4 animate-fade-in";
            let imgHTML = nexusImgBase64 ? `<img src="${nexusImgBase64}" class="h-20 rounded mb-2 block ml-auto border border-white/30">` : '';
            uDiv.innerHTML = `<div class="max-w-[80%] text-right">${imgHTML}<div class="bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-tr-sm text-sm inline-block text-left">${txt}</div></div>`;
            chat.appendChild(uDiv);

            const lDiv = document.createElement('div');
            lDiv.className = "flex justify-start mb-4 animate-fade-in";
            lDiv.innerHTML = `<div class="bg-slate-200 px-4 py-2 rounded-2xl rounded-tl-sm text-xs flex items-center gap-1"><span class="typing-dot">.</span><span class="typing-dot">.</span><span class="typing-dot">.</span></div>`;
            chat.appendChild(lDiv);
            chat.scrollTop = chat.scrollHeight;

            try {
                const cleanBase64 = nexusImgBase64 ? nexusImgBase64.split(',')[1] : null;
                const response = await callGemini(txt, "You are Nexus, a helpful AI assistant.", cleanBase64);
                lDiv.innerHTML = `<div class="bg-white px-5 py-4 rounded-2xl rounded-tl-sm text-sm shadow-sm border prose prose-sm">${marked.parse(response)}</div>`;
            } catch(e) {
                lDiv.innerHTML = "<span class='text-red-500'>Connection Error.</span>";
            }
            nexusImgBase64 = null;
        }

        // --- SHARED API UTILS ---
        async function callGemini(userTxt, sysTxt = "Helpful Assistant", b64Img) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const parts = [];
            if(userTxt) parts.push({text: userTxt});
            if(b64Img) parts.push({inlineData: {mimeType: "image/jpeg", data: b64Img}}); 

            const payload = {
                contents: [{ role: "user", parts: parts }],
                systemInstruction: { parts: [{ text: sysTxt }] },
                tools: [{ googleSearch: {} }]
            };

            const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
            const data = await res.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
        }

    </script>
</body>
</html>